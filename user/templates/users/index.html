
{% extends "base.html" %}

{% block title %} Lista de Usuarios {% endblock %}

<script>
{% block jquery %}

    $(document).ready(function () {
        var table = $('#tblUsuario').DataTable({
            language: {
                "decimal": "",
                "emptyTable": "No hay información",
                "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                "infoPostFix": "",
                "thousands": ",",
                "lengthMenu": "Mostrar _MENU_ Entradas",
                "loadingRecords": "Cargando...",
                "processing": "Procesando...",
                "search": "",
                "searchPlaceholder": "Buscar...",
                "zeroRecords": "Sin resultados encontrados",
                "paginate": {
                    "first": "Primero",
                    "last": "Ultimo",
                    "next": "Siguiente",
                    "previous": "Anterior"
                }
            }
        });
    });

    function confirmDelete(id){
        Swal.fire({
            title: 'Está seguro de eliminar el registro?',
            text: "",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Eliminar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                $("#mdProcesando").modal('show');

                var endpoint = 'delete/' + id
                $.ajax({
                    method: "GET",
                    url: endpoint,
                    success: function(data){
                        $("#mdProcesando").modal('hide');
                        Swal.fire(
                            'Eliminado',
                            'El registro se ha eliminado.',
                            'success'
                        )
                        location.reload()
                    },
                    error: function(error_data){
                        console.log("error")
                    }
                })
            }
        })
    }
{% endblock %}
</script>

{% block content %}

{% load static %}

<div class="card">
    <div class="card-header">
        <a name="" id="" class="btn btn-primary" href="{% url 'create' %}" role="button">Agregar</a>
        <button class="btn btn-success" type="button" data-bs-toggle="modal" data-bs-target="#exampleModalLg">Importar</button>
    </div>
    <div class="card-body">
        <h4 class="card-title">Usuarios</h4>
        <table id="tblUsuario" style="width:100%">
            <thead>
                <tr>
                    <th>Nombres</th>
                    <th>Apellido Paterno</th>
                    <th>Apellido Materno</th>
                    <th>Email</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                {% for user in object_list %}
                <tr>
                    <td>{{ user.nombres }}</td>
                    <td>{{ user.apellido_paterno }}</td>
                    <td>{{ user.apellido_materno }}</td>
                    <td>{{ user.email }}</td>
                    <td>
                        <a name="" id="" class="btn btn-warning" href="{% url 'edit' user.id %}" role="button">Editar</a>
                        |
                        <button class="btn btn-danger" type="button" onclick="confirmDelete({{ user.id }})">Borrar</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
    </div>
</div>

<div class="modal fade" id="exampleModalLg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Importar Usuarios</h5>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" enctype="multipart/form-data" action="{% url 'import' %}">
                    {% csrf_token %}
                    <input type="file" name="xlsUser">
                    <br><br>
                    <input name="" id="" class="btn btn-success" type="submit" value="Cargar">
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-primary" type="button" data-bs-dismiss="modal">Cerrar</button></div>
        </div>
    </div>
</div>

<div id="mdProcesando" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" style="text-align: center">
                <img src="{% static 'img/procesando.gif' %}" alt="User Avatar" width="80%">
            </div>
        </div>
    </div>
</div>

{% endblock %}